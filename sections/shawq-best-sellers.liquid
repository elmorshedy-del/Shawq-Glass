<style>
  #shopify-section-{{ section.id }} {
    --product-list-column-count: {{ section.settings.products_per_row_mobile | times: 1 }};
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} {
      --product-list-column-count: 2;
    }
  }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} {
      --product-list-column-count: {{ section.settings.products_per_row_desktop }};
    }
  }
</style>

<div class="color-scheme color-scheme--{{ section.settings.color_scheme.id }}">
  <div class="container">
    <div class="section-spacing section-spacing--{{ section.settings.section_spacing }}">
      <div class="v-stack gap-8">
        {%- if section.settings.heading != blank -%}
          <div class="prose">
            <h2 class="h2">{{ section.settings.heading }}</h2>
            {%- if section.settings.subheading != blank -%}
              <p class="subheading">{{ section.settings.subheading }}</p>
            {%- endif -%}
          </div>
        {%- endif -%}

        {%- liquid
          assign collection = section.settings.collection
          assign limit = section.settings.limit | at_least: 1
        -%}

        <product-list id="product-list-{{ section.id }}" cell-selector=".product-card" class="product-list{% unless section.settings.stack_products_mobile %} product-list--carousel scroll-area bleed md:unbleed{% endunless %}{% unless section.settings.stack_products_desktop %} md:product-list--carousel scroll-area{% endunless %}">
          {%- capture sizes -%}(max-width: 699px) calc(100vw / {{ section.settings.products_per_row_mobile }} - 40px), (max-width: 999px) calc(100vw / {{ 3 | at_most: section.settings.products_per_row_desktop }} - 64px), calc((100vw - 96px) / {{ section.settings.products_per_row_desktop }}){%- endcapture -%}

          {%- if collection != blank and collection.products_count > 0 -%}
            {%- for product in collection.products limit: limit -%}
              {%- render 'product-card', product: product, reveal: true, sizes: sizes, position: forloop.index -%}
            {%- endfor -%}
          {%- else -%}
            {%- for i in (1..4) -%}
              {%- render 'product-card-placeholder', loop_index: i -%}
            {%- endfor -%}
          {%- endif -%}
        </product-list>

        {%- if section.settings.view_all_label != blank and collection != blank -%}
          <div class="text-center">
            {%- render 'button', content: section.settings.view_all_label, href: collection.url, style: section.settings.view_all_style -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Shawq — Best sellers",
  "tag": "section",
  "class": "shopify-section--shawq-best-sellers",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "section_spacing",
      "label": "Section spacing",
      "options": [
        {"value": "none", "label": "None"},
        {"value": "tight", "label": "Tight"},
        {"value": "regular", "label": "Regular"},
        {"value": "loose", "label": "Loose"}
      ],
      "default": "regular"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Best sellers"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "The pieces people come back for."
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "limit",
      "label": "Products to show",
      "min": 4,
      "max": 24,
      "step": 1,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "stack_products_mobile",
      "label": "Stack products (mobile)",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "stack_products_desktop",
      "label": "Stack products (desktop)",
      "default": true
    },
    {
      "type": "select",
      "id": "products_per_row_mobile",
      "label": "Products per row (mobile)",
      "options": [
        {"value": "1", "label": "1"},
        {"value": "2", "label": "2"}
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "products_per_row_desktop",
      "label": "Products per row (desktop)",
      "min": 3,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "text",
      "id": "view_all_label",
      "label": "View all label",
      "default": "Shop all"
    },
    {
      "type": "select",
      "id": "view_all_style",
      "label": "View all button style",
      "options": [
        {"value": "primary", "label": "Primary"},
        {"value": "secondary", "label": "Secondary"},
        {"value": "tertiary", "label": "Tertiary"}
      ],
      "default": "secondary"
    }
  ],
  "presets": [
    {
      "name": "Shawq — Best sellers"
    }
  ]
}
{% endschema %}
